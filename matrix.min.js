(function(h,g){var e=h.xmath||{},f=function(v){return Array.prototype.slice.call(v,0);},r=function(v){var w,x=[];for(w=0;w<v.length;w++){x[w]=(v[w] instanceof Array)?r(v[w]):v[w];}return x;},m=function(){var v=f(arguments);if(v.length===1){if(v[0] instanceof o){return v[0].copy();}if(v[0] instanceof Array){return v[0];}}return v;},t=function(v){return(v instanceof o)?v.copy():v;},k=function(v){return typeof(v)==="number"&&!isNaN(v);},p=function(v){return v=Number(String(v instanceof Object?true:v)),k(v);},u=function(v){return 1/v;},d=function(){var v=m.apply(null,arguments),x,w;if(v.length===0){return false;}while(v.length>0){x=v.shift();w=w||x.length;if(x instanceof Array){if(!(x.length===w&&x.filter(function(y){return p(y);}).length===w)){return false;}}else{throw new Error("Invalid arguments.");}}return true;},q=function(v,B,z){var A,y,x=[],w;for(A=0;A<v.length;A++){if(A!==B){w=[];for(y=0;y<v[0].length;y++){if(y!==z){w.push(v[A][y]);}}x.push(w);}}return x;},b=function(z,v){var x,w,y=[v.length,v[0].length];for(x=0;x<y[0];x++){for(w=0;w<y[1];w++){v[x][w]*=z;}}return v;},j=function(z,y){var x,w,v,C,D=[z.length,z[0].length],B=[y.length,y[0].length],A=[];if(D[1]===B[0]){for(x=0;x<D[0];x++){A[x]=[];for(w=0;w<B[1];w++){C=0;for(v=0;v<D[1];v++){C+=z[x][v]*y[v][w];}A[x][w]=C;}}return A;}throw new Error("Matrices not compatible.");},c=function(w,v){var B,z,w=t(w),v=t(v),A,y,x=[];if(!(d.apply(null,w)&&d.apply(null,v))){throw new Error("Invalid arguments.");}A=[w.length,w[0].length];y=[v.length,v[0].length];if(!(A[0]===y[0]&&A[1]===y[1])){throw new Error("Matrices not compatible.");}for(B=0;B<A[0];B++){x[B]=[];for(z=0;z<A[1];z++){x[B][z]=w[B][z]+v[B][z];}}return x;},a=function(w,v){var w=t(w),v=t(v);if(k(w)){if(k(v)){return w*v;}else{if(d.apply(null,v)){return b(w,v);}}}else{if(d.apply(null,w)){if(k(v)){return b(v,w);}else{if(d.apply(null,v)){return j(w,v);}}}}throw new Error("Invalid arguments.");},i=function(v){return function(){var x=f(arguments),w=v.apply(null,x.splice(0,2));while(x.length<0){w=v.call(null,w,x.shift());}return w;};},n=function(v){return function(x,w){if(w instanceof Array){return v[x].apply(v,w);}};},s=function(w,x){var v,x=x||{};for(v in w){if(w.hasOwnProperty(v)){x[v]=w[v];}}return x;},o=s({ok:function(){return d.apply(null,m.apply(null,arguments));},dimension:function(){var v=m.apply(null,arguments);if(arguments.length===1){return n(o)("dimension",v);}if(n(this)("ok",v)){return[v.length,v[0].length];}throw new Error("Invalid matrix specification.");},unit:function(y){var x,w,y=(p(y)&&y>=2&&Number(y))||2,v=[];for(x=0;x<y;x++){v[x]=[];for(w=0;w<y;w++){v[x][w]=(x===w)?1:0;}}return v;},equal:function(w,v){var A,y,w=t(w),v=t(v),z=n(this)("dimension",w),x=n(this)("dimension",v);if(!(z[0]===x[0]&&z[1]===x[1])){return false;}for(A=0;A<z[0];A++){for(y=0;y<z[1];y++){if(w[A][y]!==v[A][y]){return false;}}}return true;},sum:function(){return i(c).apply(null,f(arguments));},product:function(){return i(a).apply(null,f(arguments));},transpose:function(){var y,x,w=m.apply(null,arguments),z=n(this)("dimension",w).reverse(),v=[];for(y=0;y<z[0];y++){v[y]=[];for(x=0;x<z[1];x++){v[y][x]=w[x][y];}}return v;},determinant:function(){var x,v=f(arguments),y=n(this)("dimension",v),w;if(y[0]!==y[1]){throw new Error("Square matrix required.");}if(y[0]===1){return v[0][0];}for(x=0;x<v[0].length;x++){w=w||0;w+=((x&1)===0?1:-1)*v[0][x]*n(this)("determinant",q(v,0,x));}return w;},minors:function(){var y,x,w=f(arguments),z=n(this)("dimension",w),v=[];if(z[0]!==z[1]){throw new Error("Square matrix required.");}for(y=0;y<z[0];y++){v[y]=[];for(x=0;x<z[0];x++){v[y][x]=n(this)("determinant",q(w,y,x));}}return v;},cofactors:function(){var y,x,w=f(arguments),z=n(this)("dimension",w),v=n(this)("minors",w);for(y=0;y<z[0];y++){for(x=0;x<z[0];x++){v[y][x]*=((y+x)&1)===0?1:-1;}}return v;},adjoint:function(){return n(this)("transpose",n(this)("cofactors",f(arguments)));},inverse:function(){var v=f(arguments);return n(this)("product",[u(n(this)("determinant",v)),n(this)("adjoint",v)]);},wrap:function(){return n(new o())("define",f(arguments));}},function(){(arguments.length>0)&&n(this)("define",f(arguments));}),l=o.prototype;l=s({define:function(){var v=m.apply(null,arguments);if(arguments.length===1||n(o)("ok",v)){this.matrix=v;}else{throw new Error("Invalid matrix specification.");}return this;},copy:function(){return r(this.matrix);},dimension:function(){return n(o)("dimension",[this]);},equal:function(v){return n(o)("equal",[this,v]);},sum:function(){return n(new o())("define",(n(o)("sum",[this.copy()].concat(f(arguments)))));},product:function(){return n(new o())("define",(n(o)("product",[this.copy()].concat(f(arguments)))));},transpose:function(){return n(new o())("define",n(o)("transpose",this.copy()));},determinant:function(){return n(o)("determinant",this.matrix);},minors:function(){return n(new o())("define",n(o)("minors",this.copy()));},cofactors:function(){return n(new o())("define",n(o)("cofactors",this.copy()));},adjoint:function(){return n(new o())("define",n(o)("adjoint",this.copy()));},inverse:function(){return n(new o())("define",n(o)("inverse",this.copy()));},},l);e.Matrix=o;h.xmath=e;})(window);